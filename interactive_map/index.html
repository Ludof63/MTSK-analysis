<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Fuel Prices in Germany Mapper" />
    <title>Fuel Mapper</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.pm@latest/dist/leaflet.pm.css" />

    <style>
        @media all and (max-width: 600px) {
            #mapid {
                height: 50vh;
            }
        }

        @media all and (min-width: 601px) {
            #mapid {
                height: 94vh;
            }
        }
    </style>

</head>

<body data-nosnippet="true">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap.native@2.0.15/dist/bootstrap-native-v4.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.pm@latest/dist/leaflet.pm.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>

    <div class="container-fluid">
        <div class="row">
            <div class="col">
                <h3>Fuel Mapper</h3>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div class="folium-map" id="mapid"></div>
            </div>
            <div class="col-lg-2">
                <div class="form-group">
                    Cell level: <output name="minOutputName" id="minOutputId">1</output> to <output name="maxOutputName"
                        id="maxOutputId">30</output>
                    <input type="range" class="custom-range" min="1" max="30" value="1" id="minRange"
                        oninput="minOutputId.value = minRange.value; updateCellRangeMinMax(minRange);">
                    <input type="range" class="custom-range" min="1" max="30" value="30" id="maxRange"
                        oninput="maxOutputId.value = maxRange.value; updateCellRangeMinMax(maxRange);">

                    <label for="maxCellsRange">Maximum cells:</label>
                    <output name="maxCellsOutputName" id="maxCellsOutputId">12</output>
                    <input type="range" class="custom-range" min="1" max="400" value="12" id="maxCellsRange"
                        oninput="maxCellsOutputId.value = maxCellsRange.value">
                    <input type="radio" id="icover" name="cover" value="in">
                    <label for="icover">Inside</label>
                    &nbsp; &nbsp;
                    <input type="radio" id="ocover" name="cover" value="out" checked>
                    <label for="ocover">Outside</label><br>
                    <button onClick="test()" id="coverButton" class="btn btn-secondary">Cover</button>
                </div>
            </div>
        </div>
    </div>
    </div>


    <script>
        //MAP ------------------------------------------------------
        var map = L.map('mapid', {
            center: [51.1657, 10.4515],
            crs: L.CRS.EPSG3857,
            zoom: 7,
            zoomControl: true,
            preferCanvas: false,
        });
        var tile_layer = L.tileLayer(
            "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",
            { "attribution": "\u0026copy; \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors \u0026copy; \u003ca href=\"https://carto.com/attributions\"\u003eCARTO\u003c/a\u003e", "detectRetina": false, "maxNativeZoom": 20, "maxZoom": 20, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abcd", "tms": false }
        );

        tile_layer.addTo(map);



        //COLORMAP -------------------------------------
        var color_map = {};
        color_map.color = d3.scale.threshold()
            .domain([-3.0, -2.987975951903808, -2.975951903807615, -2.963927855711423, -2.9519038076152304, -2.9398797595190382, -2.9278557114228456, -2.9158316633266534, -2.903807615230461, -2.8917835671342687, -2.879759519038076, -2.867735470941884, -2.8557114228456912, -2.843687374749499, -2.8316633266533064, -2.8196392785571143, -2.8076152304609217, -2.7955911823647295, -2.7835671342685373, -2.7715430861723447, -2.7595190380761525, -2.74749498997996, -2.7354709418837677, -2.723446893787575, -2.711422845691383, -2.6993987975951903, -2.687374749498998, -2.6753507014028055, -2.6633266533066133, -2.6513026052104207, -2.6392785571142285, -2.627254509018036, -2.6152304609218437, -2.603206412825651, -2.591182364729459, -2.579158316633267, -2.567134268537074, -2.5551102204408815, -2.5430861723446894, -2.531062124248497, -2.5190380761523046, -2.5070140280561124, -2.49498997995992, -2.4829659318637276, -2.470941883767535, -2.458917835671343, -2.44689378757515, -2.434869739478958, -2.4228456913827654, -2.4108216432865732, -2.3987975951903806, -2.3867735470941884, -2.3747494989979963, -2.3627254509018036, -2.350701402805611, -2.338677354709419, -2.3266533066132267, -2.314629258517034, -2.3026052104208414, -2.2905811623246493, -2.278557114228457, -2.2665330661322645, -2.2545090180360723, -2.2424849699398797, -2.2304609218436875, -2.218436873747495, -2.2064128256513027, -2.19438877755511, -2.182364729458918, -2.1703406813627253, -2.158316633266533, -2.1462925851703405, -2.1342685370741483, -2.122244488977956, -2.1102204408817635, -2.098196392785571, -2.0861723446893787, -2.0741482965931866, -2.062124248496994, -2.0501002004008018, -2.038076152304609, -2.026052104208417, -2.0140280561122244, -2.002004008016032, -1.9899799599198398, -1.9779559118236474, -1.965931863727455, -1.9539078156312626, -1.9418837675350702, -1.9298597194388778, -1.9178356713426854, -1.905811623246493, -1.8937875751503006, -1.8817635270541082, -1.8697394789579158, -1.8577154308617234, -1.845691382765531, -1.8336673346693386, -1.8216432865731462, -1.8096192384769538, -1.7975951903807614, -1.785571142284569, -1.7735470941883769, -1.7615230460921845, -1.749498997995992, -1.7374749498997997, -1.7254509018036073, -1.7134268537074149, -1.7014028056112225, -1.68937875751503, -1.6773547094188377, -1.6653306613226453, -1.653306613226453, -1.6412825651302605, -1.629258517034068, -1.6172344689378757, -1.6052104208416833, -1.593186372745491, -1.5811623246492985, -1.5691382765531061, -1.5571142284569137, -1.5450901803607215, -1.5330661322645291, -1.5210420841683367, -1.5090180360721444, -1.496993987975952, -1.4849699398797596, -1.4729458917835672, -1.4609218436873748, -1.4488977955911824, -1.43687374749499, -1.4248496993987976, -1.4128256513026052, -1.4008016032064128, -1.3887775551102204, -1.376753507014028, -1.3647294589178356, -1.3527054108216432, -1.3406813627254508, -1.3286573146292586, -1.3166332665330662, -1.3046092184368738, -1.2925851703406814, -1.280561122244489, -1.2685370741482966, -1.2565130260521042, -1.2444889779559118, -1.2324649298597194, -1.220440881763527, -1.2084168336673347, -1.1963927855711423, -1.1843687374749499, -1.1723446893787575, -1.160320641282565, -1.1482965931863727, -1.1362725450901803, -1.1242484969939879, -1.1122244488977955, -1.1002004008016033, -1.088176352705411, -1.0761523046092185, -1.0641282565130261, -1.0521042084168337, -1.0400801603206413, -1.028056112224449, -1.0160320641282565, -1.0040080160320641, -0.9919839679358717, -0.9799599198396796, -0.9679358717434869, -0.9559118236472948, -0.9438877755511021, -0.93186372745491, -0.9198396793587174, -0.9078156312625252, -0.8957915831663326, -0.8837675350701404, -0.8717434869739478, -0.8597194388777556, -0.847695390781563, -0.8356713426853708, -0.8236472945891782, -0.811623246492986, -0.7995991983967934, -0.7875751503006012, -0.775551102204409, -0.7635270541082164, -0.7515030060120242, -0.7394789579158316, -0.7274549098196395, -0.7154308617234468, -0.7034068136272547, -0.691382765531062, -0.6793587174348699, -0.6673346693386772, -0.6553106212424851, -0.6432865731462925, -0.6312625250501003, -0.6192384769539077, -0.6072144288577155, -0.5951903807615229, -0.5831663326653307, -0.5711422845691381, -0.5591182364729459, -0.5470941883767537, -0.5350701402805611, -0.5230460921843689, -0.5110220440881763, -0.49899799599198413, -0.4869739478957915, -0.47494989979959934, -0.4629258517034067, -0.45090180360721455, -0.4388777555110219, -0.42685370741482975, -0.41482965931863713, -0.40280561122244496, -0.39078156312625234, -0.37875751503006017, -0.36673346693386755, -0.35470941883767537, -0.34268537074148275, -0.3306613226452906, -0.3186372745490984, -0.3066132264529058, -0.2945891783567136, -0.282565130260521, -0.2705410821643288, -0.2585170340681362, -0.24649298597194402, -0.2344689378757514, -0.22244488977955923, -0.2104208416833666, -0.19839679358717444, -0.18637274549098182, -0.17434869739478964, -0.16232464929859702, -0.15030060120240485, -0.13827655310621223, -0.12625250501002006, -0.11422845691382744, -0.10220440881763526, -0.09018036072144309, -0.07815631262525047, -0.0661322645290583, -0.054108216432865675, -0.0420841683366735, -0.03006012024048088, -0.018036072144288706, -0.006012024048096087, 0.006012024048096087, 0.018036072144288706, 0.03006012024048088, 0.0420841683366735, 0.054108216432865675, 0.0661322645290583, 0.07815631262525047, 0.09018036072144309, 0.10220440881763526, 0.11422845691382744, 0.12625250501002006, 0.13827655310621223, 0.15030060120240485, 0.16232464929859702, 0.17434869739478964, 0.18637274549098182, 0.19839679358717444, 0.2104208416833666, 0.22244488977955923, 0.2344689378757514, 0.24649298597194402, 0.2585170340681362, 0.2705410821643288, 0.282565130260521, 0.2945891783567136, 0.3066132264529058, 0.3186372745490984, 0.3306613226452906, 0.34268537074148275, 0.35470941883767537, 0.36673346693386755, 0.37875751503006017, 0.39078156312625234, 0.40280561122244496, 0.41482965931863713, 0.42685370741482975, 0.4388777555110219, 0.45090180360721455, 0.4629258517034067, 0.47494989979959934, 0.4869739478957915, 0.49899799599198413, 0.5110220440881763, 0.5230460921843689, 0.5350701402805611, 0.5470941883767537, 0.5591182364729459, 0.5711422845691381, 0.5831663326653307, 0.5951903807615229, 0.6072144288577155, 0.6192384769539077, 0.6312625250501003, 0.6432865731462925, 0.6553106212424851, 0.6673346693386772, 0.6793587174348699, 0.691382765531062, 0.7034068136272547, 0.7154308617234468, 0.7274549098196395, 0.7394789579158316, 0.7515030060120242, 0.7635270541082164, 0.775551102204409, 0.7875751503006012, 0.7995991983967934, 0.811623246492986, 0.8236472945891782, 0.8356713426853708, 0.847695390781563, 0.8597194388777556, 0.8717434869739478, 0.8837675350701404, 0.8957915831663326, 0.9078156312625252, 0.9198396793587174, 0.93186372745491, 0.9438877755511021, 0.9559118236472948, 0.9679358717434869, 0.9799599198396796, 0.9919839679358717, 1.0040080160320644, 1.0160320641282565, 1.0280561122244487, 1.0400801603206409, 1.052104208416834, 1.0641282565130261, 1.0761523046092183, 1.0881763527054105, 1.1002004008016035, 1.1122244488977957, 1.1242484969939879, 1.13627254509018, 1.1482965931863731, 1.1603206412825653, 1.1723446893787575, 1.1843687374749496, 1.1963927855711427, 1.2084168336673349, 1.220440881763527, 1.2324649298597192, 1.2444889779559114, 1.2565130260521045, 1.2685370741482966, 1.2805611222444888, 1.292585170340681, 1.304609218436874, 1.3166332665330662, 1.3286573146292584, 1.3406813627254506, 1.3527054108216436, 1.3647294589178358, 1.376753507014028, 1.3887775551102202, 1.4008016032064132, 1.4128256513026054, 1.4248496993987976, 1.4368737474949898, 1.448897795591182, 1.460921843687375, 1.4729458917835672, 1.4849699398797593, 1.4969939879759515, 1.5090180360721446, 1.5210420841683367, 1.533066132264529, 1.545090180360721, 1.5571142284569142, 1.5691382765531063, 1.5811623246492985, 1.5931863727454907, 1.6052104208416837, 1.617234468937876, 1.629258517034068, 1.6412825651302603, 1.6533066132264533, 1.6653306613226455, 1.6773547094188377, 1.6893787575150299, 1.701402805611222, 1.713426853707415, 1.7254509018036073, 1.7374749498997994, 1.7494989979959916, 1.7615230460921847, 1.7735470941883769, 1.785571142284569, 1.7975951903807612, 1.8096192384769543, 1.8216432865731464, 1.8336673346693386, 1.8456913827655308, 1.8577154308617239, 1.869739478957916, 1.8817635270541082, 1.8937875751503004, 1.9058116232464926, 1.9178356713426856, 1.9298597194388778, 1.94188376753507, 1.9539078156312621, 1.9659318637274552, 1.9779559118236474, 1.9899799599198396, 2.0020040080160317, 2.014028056112225, 2.026052104208417, 2.038076152304609, 2.0501002004008013, 2.0621242484969944, 2.0741482965931866, 2.0861723446893787, 2.098196392785571, 2.110220440881764, 2.122244488977956, 2.1342685370741483, 2.1462925851703405, 2.1583166332665327, 2.1703406813627257, 2.182364729458918, 2.19438877755511, 2.2064128256513023, 2.2184368737474953, 2.2304609218436875, 2.2424849699398797, 2.254509018036072, 2.266533066132265, 2.278557114228457, 2.2905811623246493, 2.3026052104208414, 2.3146292585170345, 2.3266533066132267, 2.338677354709419, 2.350701402805611, 2.362725450901803, 2.3747494989979963, 2.3867735470941884, 2.3987975951903806, 2.410821643286573, 2.422845691382766, 2.434869739478958, 2.44689378757515, 2.4589178356713424, 2.4709418837675354, 2.4829659318637276, 2.49498997995992, 2.507014028056112, 2.519038076152305, 2.531062124248497, 2.5430861723446894, 2.5551102204408815, 2.5671342685370737, 2.579158316633267, 2.591182364729459, 2.603206412825651, 2.6152304609218433, 2.6272545090180364, 2.6392785571142285, 2.6513026052104207, 2.663326653306613, 2.675350701402806, 2.687374749498998, 2.6993987975951903, 2.7114228456913825, 2.7234468937875755, 2.7354709418837677, 2.74749498997996, 2.759519038076152, 2.771543086172345, 2.7835671342685373, 2.7955911823647295, 2.8076152304609217, 2.819639278557114, 2.831663326653307, 2.843687374749499, 2.8557114228456912, 2.8677354709418834, 2.8797595190380765, 2.8917835671342687, 2.903807615230461, 2.915831663326653, 2.927855711422846, 2.9398797595190382, 2.9519038076152304, 2.9639278557114226, 2.9759519038076157, 2.987975951903808, 3.0])
            .range(['#008000ff', '#018100ff', '#028100ff', '#038200ff', '#048200ff', '#058300ff', '#068300ff', '#078400ff', '#088400ff', '#098500ff', '#0a8500ff', '#0b8600ff', '#0c8600ff', '#0d8700ff', '#0e8700ff', '#0f8800ff', '#108800ff', '#118900ff', '#128900ff', '#138a00ff', '#148a00ff', '#158b00ff', '#168b00ff', '#178c00ff', '#188c00ff', '#198d00ff', '#1a8d00ff', '#1b8e00ff', '#1c8e00ff', '#1d8f00ff', '#1e8f00ff', '#1f9000ff', '#209000ff', '#219100ff', '#229100ff', '#239200ff', '#249200ff', '#259300ff', '#269300ff', '#289400ff', '#299400ff', '#2a9500ff', '#2b9500ff', '#2c9600ff', '#2d9600ff', '#2e9700ff', '#2f9800ff', '#309800ff', '#319900ff', '#329900ff', '#339a00ff', '#349a00ff', '#359b00ff', '#369b00ff', '#379c00ff', '#389c00ff', '#399d00ff', '#3a9d00ff', '#3b9e00ff', '#3c9e00ff', '#3d9f00ff', '#3e9f00ff', '#3fa000ff', '#40a000ff', '#41a100ff', '#42a100ff', '#43a200ff', '#44a200ff', '#45a300ff', '#46a300ff', '#47a400ff', '#48a400ff', '#49a500ff', '#4aa500ff', '#4ba600ff', '#4ca600ff', '#4da700ff', '#4fa700ff', '#50a800ff', '#51a800ff', '#52a900ff', '#53a900ff', '#54aa00ff', '#55aa00ff', '#56ab00ff', '#57ab00ff', '#58ac00ff', '#59ac00ff', '#5aad00ff', '#5bad00ff', '#5cae00ff', '#5daf00ff', '#5eaf00ff', '#5fb000ff', '#60b000ff', '#61b100ff', '#62b100ff', '#63b200ff', '#64b200ff', '#65b300ff', '#66b300ff', '#67b400ff', '#68b400ff', '#69b500ff', '#6ab500ff', '#6bb600ff', '#6cb600ff', '#6db700ff', '#6eb700ff', '#6fb800ff', '#70b800ff', '#71b900ff', '#72b900ff', '#73ba00ff', '#74ba00ff', '#75bb00ff', '#77bb00ff', '#78bc00ff', '#79bc00ff', '#7abd00ff', '#7bbd00ff', '#7cbe00ff', '#7dbe00ff', '#7ebf00ff', '#7fbf00ff', '#80c000ff', '#81c000ff', '#82c100ff', '#83c100ff', '#84c200ff', '#85c200ff', '#86c300ff', '#87c300ff', '#88c400ff', '#89c400ff', '#8ac500ff', '#8bc500ff', '#8cc600ff', '#8dc700ff', '#8ec700ff', '#8fc800ff', '#90c800ff', '#91c900ff', '#92c900ff', '#93ca00ff', '#94ca00ff', '#95cb00ff', '#96cb00ff', '#97cc00ff', '#98cc00ff', '#99cd00ff', '#9acd00ff', '#9bce00ff', '#9cce00ff', '#9ecf00ff', '#9fcf00ff', '#a0d000ff', '#a1d000ff', '#a2d100ff', '#a3d100ff', '#a4d200ff', '#a5d200ff', '#a6d300ff', '#a7d300ff', '#a8d400ff', '#a9d400ff', '#aad500ff', '#abd500ff', '#acd600ff', '#add600ff', '#aed700ff', '#afd700ff', '#b0d800ff', '#b1d800ff', '#b2d900ff', '#b3d900ff', '#b4da00ff', '#b5da00ff', '#b6db00ff', '#b7db00ff', '#b8dc00ff', '#b9dc00ff', '#badd00ff', '#bbde00ff', '#bcde00ff', '#bddf00ff', '#bedf00ff', '#bfe000ff', '#c0e000ff', '#c1e100ff', '#c2e100ff', '#c3e200ff', '#c5e200ff', '#c6e300ff', '#c7e300ff', '#c8e400ff', '#c9e400ff', '#cae500ff', '#cbe500ff', '#cce600ff', '#cde600ff', '#cee700ff', '#cfe700ff', '#d0e800ff', '#d1e800ff', '#d2e900ff', '#d3e900ff', '#d4ea00ff', '#d5ea00ff', '#d6eb00ff', '#d7eb00ff', '#d8ec00ff', '#d9ec00ff', '#daed00ff', '#dbed00ff', '#dcee00ff', '#ddee00ff', '#deef00ff', '#dfef00ff', '#e0f000ff', '#e1f000ff', '#e2f100ff', '#e3f100ff', '#e4f200ff', '#e5f200ff', '#e6f300ff', '#e7f300ff', '#e8f400ff', '#e9f500ff', '#eaf500ff', '#ebf600ff', '#edf600ff', '#eef700ff', '#eff700ff', '#f0f800ff', '#f1f800ff', '#f2f900ff', '#f3f900ff', '#f4fa00ff', '#f5fa00ff', '#f6fb00ff', '#f7fb00ff', '#f8fc00ff', '#f9fc00ff', '#fafd00ff', '#fbfd00ff', '#fcfe00ff', '#fdfe00ff', '#feff00ff', '#ffff00ff', '#ffff00ff', '#fffe00ff', '#fffd00ff', '#fffc00ff', '#fffb00ff', '#fffa00ff', '#fff900ff', '#fff800ff', '#fff700ff', '#fff600ff', '#fff500ff', '#fff400ff', '#fff300ff', '#fff200ff', '#fff100ff', '#fff000ff', '#ffef00ff', '#ffee00ff', '#ffed00ff', '#ffeb00ff', '#ffea00ff', '#ffe900ff', '#ffe800ff', '#ffe700ff', '#ffe600ff', '#ffe500ff', '#ffe400ff', '#ffe300ff', '#ffe200ff', '#ffe100ff', '#ffe000ff', '#ffdf00ff', '#ffde00ff', '#ffdd00ff', '#ffdc00ff', '#ffdb00ff', '#ffda00ff', '#ffd900ff', '#ffd800ff', '#ffd700ff', '#ffd600ff', '#ffd500ff', '#ffd400ff', '#ffd300ff', '#ffd200ff', '#ffd100ff', '#ffd000ff', '#ffcf00ff', '#ffce00ff', '#ffcd00ff', '#ffcc00ff', '#ffcb00ff', '#ffca00ff', '#ffc900ff', '#ffc800ff', '#ffc700ff', '#ffc600ff', '#ffc500ff', '#ffc300ff', '#ffc200ff', '#ffc100ff', '#ffc000ff', '#ffbf00ff', '#ffbe00ff', '#ffbd00ff', '#ffbc00ff', '#ffbb00ff', '#ffba00ff', '#ffb900ff', '#ffb800ff', '#ffb700ff', '#ffb600ff', '#ffb500ff', '#ffb400ff', '#ffb300ff', '#ffb200ff', '#ffb100ff', '#ffb000ff', '#ffaf00ff', '#ffae00ff', '#ffad00ff', '#ffac00ff', '#ffab00ff', '#ffaa00ff', '#ffa900ff', '#ffa800ff', '#ffa700ff', '#ffa600ff', '#ffa500ff', '#ffa400ff', '#ffa300ff', '#ffa200ff', '#ffa100ff', '#ffa000ff', '#ff9f00ff', '#ff9e00ff', '#ff9c00ff', '#ff9b00ff', '#ff9a00ff', '#ff9900ff', '#ff9800ff', '#ff9700ff', '#ff9600ff', '#ff9500ff', '#ff9400ff', '#ff9300ff', '#ff9200ff', '#ff9100ff', '#ff9000ff', '#ff8f00ff', '#ff8e00ff', '#ff8d00ff', '#ff8c00ff', '#ff8b00ff', '#ff8a00ff', '#ff8900ff', '#ff8800ff', '#ff8700ff', '#ff8600ff', '#ff8500ff', '#ff8400ff', '#ff8300ff', '#ff8200ff', '#ff8100ff', '#ff8000ff', '#ff7f00ff', '#ff7e00ff', '#ff7d00ff', '#ff7c00ff', '#ff7b00ff', '#ff7a00ff', '#ff7900ff', '#ff7800ff', '#ff7700ff', '#ff7500ff', '#ff7400ff', '#ff7300ff', '#ff7200ff', '#ff7100ff', '#ff7000ff', '#ff6f00ff', '#ff6e00ff', '#ff6d00ff', '#ff6c00ff', '#ff6b00ff', '#ff6a00ff', '#ff6900ff', '#ff6800ff', '#ff6700ff', '#ff6600ff', '#ff6500ff', '#ff6400ff', '#ff6300ff', '#ff6200ff', '#ff6100ff', '#ff6000ff', '#ff5f00ff', '#ff5e00ff', '#ff5d00ff', '#ff5c00ff', '#ff5b00ff', '#ff5a00ff', '#ff5900ff', '#ff5800ff', '#ff5700ff', '#ff5600ff', '#ff5500ff', '#ff5400ff', '#ff5300ff', '#ff5200ff', '#ff5100ff', '#ff5000ff', '#ff4f00ff', '#ff4d00ff', '#ff4c00ff', '#ff4b00ff', '#ff4a00ff', '#ff4900ff', '#ff4800ff', '#ff4700ff', '#ff4600ff', '#ff4500ff', '#ff4400ff', '#ff4300ff', '#ff4200ff', '#ff4100ff', '#ff4000ff', '#ff3f00ff', '#ff3e00ff', '#ff3d00ff', '#ff3c00ff', '#ff3b00ff', '#ff3a00ff', '#ff3900ff', '#ff3800ff', '#ff3700ff', '#ff3600ff', '#ff3500ff', '#ff3400ff', '#ff3300ff', '#ff3200ff', '#ff3100ff', '#ff3000ff', '#ff2f00ff', '#ff2e00ff', '#ff2d00ff', '#ff2c00ff', '#ff2b00ff', '#ff2a00ff', '#ff2900ff', '#ff2800ff', '#ff2600ff', '#ff2500ff', '#ff2400ff', '#ff2300ff', '#ff2200ff', '#ff2100ff', '#ff2000ff', '#ff1f00ff', '#ff1e00ff', '#ff1d00ff', '#ff1c00ff', '#ff1b00ff', '#ff1a00ff', '#ff1900ff', '#ff1800ff', '#ff1700ff', '#ff1600ff', '#ff1500ff', '#ff1400ff', '#ff1300ff', '#ff1200ff', '#ff1100ff', '#ff1000ff', '#ff0f00ff', '#ff0e00ff', '#ff0d00ff', '#ff0c00ff', '#ff0b00ff', '#ff0a00ff', '#ff0900ff', '#ff0800ff', '#ff0700ff', '#ff0600ff', '#ff0500ff', '#ff0400ff', '#ff0300ff', '#ff0200ff', '#ff0100ff', '#ff0000ff']);


        color_map.x = d3.scale.linear()
            .domain([-3.0, 3.0])
            .range([0, 450 - 50]);

        color_map.legend = L.control({ position: 'topright' });
        color_map.legend.onAdd = function (map) { var div = L.DomUtil.create('div', 'legend'); return div };
        color_map.legend.addTo(map);

        color_map.xAxis = d3.svg.axis()
            .scale(color_map.x)
            .orient("top")
            .tickSize(1)
            .tickValues([-3.0, 0.0, 3.0]);

        color_map.svg = d3.select(".legend.leaflet-control").append("svg")
            .attr("id", 'legend')
            .attr("width", 450)
            .attr("height", 40);

        color_map.g = color_map.svg.append("g")
            .attr("class", "key")
            .attr("fill", "black")
            .attr("transform", "translate(25,16)");

        color_map.g.selectAll("rect")
            .data(color_map.color.range().map(function (d, i) {
                return {
                    x0: i ? color_map.x(color_map.color.domain()[i - 1]) : color_map.x.range()[0],
                    x1: i < color_map.color.domain().length ? color_map.x(color_map.color.domain()[i]) : color_map.x.range()[1],
                    z: d
                };
            }))
            .enter().append("rect")
            .attr("height", 40 - 30)
            .attr("x", function (d) { return d.x0; })
            .attr("width", function (d) { return d.x1 - d.x0; })
            .style("fill", function (d) { return d.z; });

        color_map.g.call(color_map.xAxis).append("text")
            .attr("class", "caption")
            .attr("y", 21)
            .attr("fill", "black")
            .text("Deviation from mean");




        //DIESEL CLUSTER ------------------------------------
        var diesel_cluster = L.markerClusterGroup(
            { "disableClusteringAtZoom": 9 }
        );

        diesel_cluster.options.iconCreateFunction =
            function (cluster) {
                var childCount = cluster.getChildCount();

                var c = ' marker-cluster-';
                if (childCount < 10) {
                    c += 'small';
                } else if (childCount < 100) {
                    c += 'medium';
                } else {
                    c += 'large';
                }


                var markers = cluster.getAllChildMarkers();
                var total = 0;

                markers.forEach(function (marker) { total += marker.options['z_score']; });
                var score = total / childCount;


                var color = "";
                if (score < -3) { color = 'pink'; }
                else if (score < -2.4) { color = '#389c00ff'; }
                else if (score < -1.8) { color = '#71b900ff'; }
                else if (score < -1.2) { color = '#aad500ff'; }
                else if (score < -0.6000000000000001) { color = '#e3f100ff'; }
                else if (score < 0.0) { color = '#ffe300ff'; }
                else if (score < 0.6000000000000001) { color = '#ffaa00ff'; }
                else if (score < 1.2000000000000002) { color = '#ff7100ff'; }
                else if (score < 1.7999999999999998) { color = '#ff3800ff'; }
                else if (score < 2.4000000000000004) { color = '#ff0000ff'; }
                else if (score < 3.0) { color = '#ff0000ff'; }
                else { color = 'blak'; }

                return new L.DivIcon({ html: '<div style="background-color:' + color + '";><span>' + childCount + '</span></div>', className: 'marker-cluster' + c, iconSize: new L.Point(40, 40) });
            };

        diesel_cluster.addTo(map);


        //LAYER CONTROL ------------------------------------
        var layer_control = {
            base_layers: {
                "diesel": diesel_cluster,
            },
            overlays: {
            },
        };
        let layer_control_aux = L.control.layers(
            layer_control.base_layers,
            layer_control.overlays,
            { "autoZIndex": true, "collapsed": true, "position": "topright" }
        ).addTo(map);



    </script>



    <script>
        async function test() {
            console.log("exectuing test");
            const targetDate = "2024-04-30T12:00:00Z";
            const interval = "30 minutes";

            try {
                const response = await fetch(`/stations?target_date=${encodeURIComponent(targetDate)}&interval=${encodeURIComponent(interval)}`);
                if (!response.ok) {
                    throw new Error(`Error fetching stations: ${response.statusText}`);
                }

                const stations = await response.json();
                console.log("Stations:", stations);

                // Example: Add markers to the map
                stations.forEach(station => {
                    L.marker([station.latitude, station.longitude])
                        .addTo(map)
                        .bindPopup(`<b>${station.name}</b><br>Diesel Price: ${station.diesel}<br>Time: ${station.time}`);
                });
            } catch (error) {
                console.error("Failed to fetch stations:", error);
            }
        }

    </script>



</body>

</html>






<!-- <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Station Locator</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 500px;
            width: 100%;
        }

        #query-box {
            margin: 10px;
        }
    </style>
</head>

<body>
    <h1>Station Locator</h1>
    <div id="query-box">
        <input type="text" id="station-id" placeholder="Enter Station ID" />
        <button id="search-btn">Search</button>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>





    <script>
        const map = L.map('map').setView([51.505, -0.09], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(map);

        document.getElementById('search-btn').addEventListener('click', async () => {
            const stationID = document.getElementById('station-id').value;
            if (!stationID) {
                alert("Please enter a station ID.");
                return;
            }

            try {
                const response = await fetch(`/station?id=${stationID}`);
                if (!response.ok) {
                    throw new Error("Station not found");
                }

                const data = await response.json();
                const { latitude, longitude } = data;

                map.setView([latitude, longitude], 13);
                L.marker([latitude, longitude]).addTo(map)
                    .bindPopup(`Station ID: ${stationID}`)
                    .openPopup();
            } catch (error) {
                alert("Error: " + error.message);
            }
        });
    </script>
</body>

</html> -->